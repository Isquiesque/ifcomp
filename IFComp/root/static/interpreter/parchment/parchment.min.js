jQuery.ajaxSetup({cache:1,converters:{"* binary":true}});jQuery.ajaxPrefilter("script",function(a){if(a.isLocal)a.crossDomain=1});var parchment={options:{container:"#parchment",lib_path:"lib/",page_title:1,panels:["search","url","about"],proxy_url:"http://zcode.appspot.com/proxy/",width:80},lib:{}};
(function(){var a=false,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;Object.subClass=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var g=this.prototype;a=true;var k=new this;a=false;for(var i in c)k[i]=typeof c[i]=="function"&&typeof g[i]=="function"&&b.test(c[i])?function(a,b){return function(){var f=this._super;this._super=g[a];var j=b.apply(this,arguments);this._super=f;return j}}(i,c[i]):c[i];d.prototype=k;d.constructor=d;d.subClass=arguments.callee;return d}})();
(function(){function a(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}function b(a){return[a>>24&255,a>>16&255,a>>8&255,a&255]}function c(a,b){return String.fromCharCode(a[b],a[b+1],a[b+2],a[b+3])}function d(a){return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]}var g=Object.subClass({init:function(b){this.type="";this.chunks=[];if(b){if(c(b,0)!="FORM")throw Error("Not an IFF file");this.type=c(b,8);for(var d=12,g=b.length;d<g;){var h=a(b,d+4);if(h<0||h+d>g)throw Error("IFF: Chunk out of range");
this.chunks.push({type:c(b,d),offset:d,data:b.slice(d+8,d+8+h)});d+=8+h;h%2&&d++}}},write:function(){for(var a=d(this.type),c=0,g=this.chunks.length;c<g;c++){var h=this.chunks[c],f=h.data,j=f.length,a=a.concat(d(h.type),b(j),f);j%2&&a.push(0)}return d("FORM").concat(b(a.length),a)}});g.num_from=a;g.num_to_word=b;g.text_from=c;g.text_to_word=d;window.IFF=g})();
function typeOf(a){var b=typeof a;b==="object"&&(a?typeof a.length==="number"&&!a.propertyIsEnumerable("length")&&typeof a.splice==="function"&&(b="array"):b="null");return b}function isEmpty(a){var b,c;if(typeOf(a)==="object")for(b in a)if(c=a[b],c!==void 0&&typeOf(c)!=="function")return false;return true}String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};
String.prototype.quote=function(){var a,b,c=this.length,d='"';for(b=0;b<c;b+=1)if(a=this.charAt(b),a>=" "){if(a==="\\"||a==='"')d+="\\";d+=a}else switch(a){case "\u0008":d+="\\b";break;case "\u000c":d+="\\f";break;case "\n":d+="\\n";break;case "\r":d+="\\r";break;case "\t":d+="\\t";break;default:a=a.charCodeAt(),d+="\\u00"+Math.floor(a/16).toString(16)+(a%16).toString(16)}return d+'"'};
String.prototype.supplant=function(a){return this.replace(/{([^{}]*)}/g,function(b,c){var d=a[c];return typeof d==="string"||typeof d==="number"?d:b})};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};
(function(a){window.FatalError=function(b){this.message=b;this.traceback=this._makeTraceback(arguments.callee);this.onError(this);a(".load").length>0&&a(".load").detach()};FatalError.prototype={onError:function(b){var c=b.message;typeof b.message=="string"&&(c=c.entityify());a("#parchment").append('<div class="error">An error occurred:<br/><pre>'+c+"\n\n"+b.traceback+"</pre></div>");window.console&&console.error(c)},_makeTraceback:function(a){for(var c="",d=0;a!=null&&d<100;){var g=a.toString();g?
(g=g.match(/function (\w*)/),c=!g||!g[1]?"\n  (anonymous function)"+c:"\n  "+g[1]+c):c="\n  (anonymous function)"+c;try{a=a.caller}catch(k){a=null}d++}d==100&&(c="..."+c);return"Traceback (most recent call last):\n"+c}}})(jQuery);
(function(a,b){a.execScript&&execScript("Function VBCStr(x)\nVBCStr=CStr(x)\nEnd Function\nFunction VBLastAsc(x)\nDim l\nl=LenB(x)\nIf l mod 2 Then\nVBLastAsc=AscB(MidB(x,l,1))\nElse\nVBLastAsc=-1\nEnd If\nEnd Function","VBScript");var c=/chrome\/(\d+)/i.exec(navigator.userAgent),d=c&&parseInt(c[1])>4,g=function(a,b){var b=b||[],e=0,f;for(f=a.length%8;e<f;++e)b.push(a.charCodeAt(e)&255);for(f=a.length;e<f;)b.push(a.charCodeAt(e++)&255,a.charCodeAt(e++)&255,a.charCodeAt(e++)&255,a.charCodeAt(e++)&
255,a.charCodeAt(e++)&255,a.charCodeAt(e++)&255,a.charCodeAt(e++)&255,a.charCodeAt(e++)&255);return b},k=function(a,b){return(b||"")+String.fromCharCode.apply(1,a)},i=function(){for(var a=[],b=0;b<65;b++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)]=b;return a}(),l=function(b,f){if(a.atob)return g(atob(b),f);for(var f=f||[],e,c,d,h,m,n=0,k=b.length;n<k;)e=i[b.charAt(n++)],c=i[b.charAt(n++)],h=i[b.charAt(n++)],m=i[b.charAt(n++)],e=(e<<2)+(c>>4),c=((c&15)<<4)+(h>>
2),d=((h&3)<<6)+m,f.push(e,c,d);m==64&&f.pop();h==64&&f.pop();return f},c=jQuery.ajaxSettings.xhr(),h={binary:c.overrideMimeType&&!(b.browser.opera&&parseFloat(b.browser.version)<10.5)?"charset":"responseBody"in c?"responseBody":0},f=function(j,f,e){var c,d,j=b.trim(j);if(e.mode=="base64")a.atob?(d=atob(j),c=g(d)):c=l(j);else if(e.mode=="charset")c=g(j);else{for(var f=e.xhr.responseBody,j=VBCStr(f),f=VBLastAsc(f),h=[],m=0,n=j.length%4;m<n;)h.push((c=j.charCodeAt(m++))&255,c>>8);for(n=j.length;m<n;)h.push((c=
j.charCodeAt(m++))&255,c>>8,(c=j.charCodeAt(m++))&255,c>>8,(c=j.charCodeAt(m++))&255,c>>8,(c=j.charCodeAt(m++))&255,c>>8);f>-1&&h.push(f);c=h}e.responseArray=c;e.responseText=d},c=void 0;b.ajaxPrefilter("binary",function(a,c,e){var c=a.isLocal&&!a.crossDomain&&d?0:h.binary,g=a.xhr;a.xhr=function(){return e.xhr=g.apply(a)};a.binary=c;e.done(f);a.jsonp=false;a.jsonpCallback="processBase64Zcode";e.mode="base64";if(a.url.slice(-3).toLowerCase()==".js")return"jsonp";if(c&&!a.crossDomain)return"text";if(a.legacy)return a.url=
a.legacy,"jsonp";a.data="url="+a.url;a.url=parchment.options.proxy_url;if(c&&b.support.cors)return"text";a.data+="&encode=base64&callback=pproxy";a.jsonpCallback="pproxy";return"jsonp"});b.ajaxPrefilter("text",function(a,b,c){c.mode=a.binary;if(c.mode=="charset")a.mimeType="text/plain; charset=x-user-defined"});a.file={text_to_array:g,array_to_text:k,base64_decode:l,base64_encode:function(b,c){if(a.btoa)return btoa(k(b,c));for(var c=c||"",f,d,h,g,m,n,i=0,l=b.length;i<l;)f=b[i++],d=b[i++],h=b[i++],
g=f>>2,f=((f&3)<<4)+(d>>4),m=((d&15)<<2)+(h>>6),n=h&63,c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n);isNaN(d)?c=c.slice(0,-2)+"==":isNaN(h)&&(c=c.slice(0,-1)+"=");return c},support:h};a.file.download_to_array=function(a,c){b.ajax(a,
{dataType:"binary"}).success(function(a,b,f){c(f.responseArray)})}})(window,jQuery);
(function(a){var b=a(this),c=a(document),d,g=/\S/,k=this.scrollByPages||function(a){var b=c[0].documentElement.clientHeight;b-=Math.min(b/10,parseInt(d.css("line-height"))*2);scrollBy(0,b*a)},i=this.getSelection||document.selection&&function(){return document.selection.createRange().text}||function(){return""},l='<p><a href="'+location.href+"?story=http://mirror.ifarchive.org/",h=function(a){return l+a.path+'">'+a.desc.entityify()+"</a></p>"};a(function(){d=a("body")});this.gIsIphone=/iPhone|iPod|iPad|Android/i.test(navigator.userAgent);
a.browser.msie&&parseInt(a.browser.version)<7&&a(function(){var b=a("#top-window"),c=function(){b.style.top=document.documentElement.scrollTop+"px"};b.css("position","absolute").resize(c).scroll(c)});parchment.lib.UI=Object.subClass({init:function(b){this.library=b;this.panels={};this.load_indicator=a('<div class="dialog load"><p>Parchment is loading.<p>&gt; <blink>_</blink></div>')},stylesheet_add:function(){var b=arguments,c;for(c=1;c<b.length;c++)document.createStyleSheet?document.createStyleSheet(b[c]):
a("<link>",{rel:"alternate stylesheet",href:b[c],title:b[0],type:"text/css"}).appendTo("head")[0].disabled=true},stylesheet_switch:function(b,c){a('link[rel*="stylesheet"][title="'+b+'"]').each(function(){this.disabled=!c})},load_panels:function(){var b=parchment.options.panels,c,d,e,g=function(){var b=RegExp(d.val().replace(" ","( )?"),"i"),f=a.grep(c,function(a){return b.test(a.path+a.desc)}),f=f.slice(0,30);e.html(a.map(f,h).join(""))};if(a.inArray("search",b)!=-1)this.panels.search=a('<div class="panel search"><label for="panel_search">Search the IF Archive for games you can play with Parchment. You might also like to search the <a href="http://ifdb.tads.org">IFDB</a> or the <a href="http://ifwiki.org">IF Wiki</a>.</label><input id="panel_search"><div></div></div>'),
d=this.panels.search.find("input"),e=d.next(),d.keydown(function(){d.unbind("keydown");a.getJSON("stories/if-archive.json").done(function(a){c=a;d.keyup(g);g()})});if(a.inArray("url",b)!=-1)this.panels.url=a('<form class="panel url"><label for="panel_url">You may use Parchment to play any story file on the internet, simply copy its address here:</label><input id="panel_url" name="story"></form>');this.library.container.append(this.panels[b[0]]);this.panels.active=b[0]}});parchment.lib.TextInput=Object.subClass({init:function(f,
h,g){var e=this,p=a("<input>",{autocapitalize:"off",keydown:function(a){var b=a.which,c;b==38&&(e.prev_next(1),c=1);b==40&&(e.prev_next(-1),c=1);b==33&&(k(-1),c=1);b==34&&(k(1),c=1);a.stopPropagation();if(c)return false}}),l=a("<input>",{"class":"CharInput",keydown:function(a){e.keyCode=a.which},keypress:function(a){e.charCode=a.which;e.submitChar();return false},keyup:function(){e.submitChar()}});e.form=a("<form>",{"class":"LineInput",submit:function(){e.submitLine();return false}}).append(p);c.bind("click.TextInput keydown.TextInput",
function(c){c.target.nodeName!="INPUT"&&i()==""&&b.scrollTop()+b.height()-p.offset().top>-60&&a(".LineInput input, .CharInput").focus().trigger(c)});e.history=[];e.lineInput=p;e.charInput=l;e.container=a(f);e.stream=a(h);e.topwindow=a(g);e.scrollParent=a.browser.webkit?d:a("html")},die:function(){c.unbind(".TextInput")},getLine:function(b,c){var d=this.stream.children().last(),e=this.lineInput,h=a(".finished-input").last(),g=this.scrollParent;this.callback=b||a.noop;this.current=0;this.mutable_history=
this.history.slice();this.mutable_history.unshift("");this.style=c||"";e.width(this.stream.width()-d.width()-1).val("").addClass(this.style);d.append(this.form);h.length&&g.scrollTop(h.offset().top-this.topwindow.height()-h.height())},submitLine:function(){var b=this.lineInput.val();this.form.detach();this.lineInput.removeClass(this.style);a('<span class="finished-input">'+b.entityify()+"</span><br>").appendTo(this.stream.children().last());b!=this.history[0]&&g.test(b)&&this.history.unshift(b);c.trigger({type:"LineInput",
input:b});this.callback(b)},prev_next:function(a){var b=this.lineInput,c=this.mutable_history,d=this.current,a=d+a;if(a<c.length&&a>=0)c[d]=b.val(),b.val(c[a]),this.current=a},getChar:function(b){var c=this.charInput;this.callback=b||a.noop;this.keyCode=this.charCode=0;this.container.append(c);setTimeout(function(){c.focus()},1)},submitChar:function(){var a=this.keyCode,b=this.charCode,d={keyCode:a,charCode:b};if(a||b)this.charInput.detach(),c.trigger({type:"CharInput",input:d}),this.callback(d)}})})(jQuery);
(function(a,b){var c=/story=([^;&]+)/,d=/vm=(\w+)/,g=/([-\w\s_]+)(\.[\w]+(\.js)?)?$/,k=/\.js$/,i=function(){throw new FatalError("Parchment could not load load the story. Check your connection, and that the URL is correct.");};parchment.lib.Story=IFF.subClass({init:function(a,c){this.title=c;if(a[0]<9)this._super(),this.chunks.push({type:"ZCOD",data:a}),this.zcode=a;else if(IFF.text_from(a,0)=="Glul")this._super(),this.chunks.push({type:"GLUL",data:a}),this.glulx=a;else if(IFF.text_from(a,0)=="FORM"&&
(this._super(a),this.type=="IFRS"))for(var d=0,g=this.chunks.length;d<g;d++){var e=this.chunks[d].type;if(e=="ZCOD"&&!this.zcode)this.zcode=this.chunks[d].data;else if(e=="GLUL"&&!this.glulx)this.glulx=this.chunks[d].data;else if(e=="IFmd"&&(this.metadata=file.array_to_text(this.chunks[d].data),e=b(this.metadata))){if(b("title",e))this.title=b("title",e).text();if(b("ifid",e))this.ifid=b("ifid",e).text();if(b("release",e))this.release=b("release",e).text()}}},load:function(a){this.zcode&&a.loadStory(this.zcode)}});
var l=Object.subClass({add:function(a){this[a.ifid]=a;a.url&&(this.url[a.url]=a)},url:{}}),l=Object.subClass({init:function(){this.container=b(parchment.options.container);this.ui=new parchment.lib.UI(this)},load:function(){var h=parchment.options,f=c.exec(location.search),j,i=d.exec(location.search),e=0;h.explicit_vm&&(i=[null,h.explicit_vm]);if(h.lock_story){if(f=h.default_story,!f)throw new FatalError("Story file not specified");}else if(h.default_story||f)f=f&&unescape(f[1])||h.default_story;
else return this.ui.load_panels();b("#about").remove();b("body").append(this.ui.load_indicator);b.isArray(f)||(f=[f,0]);this.url=j=f[0];storyName=(storyName=g.exec(j))?storyName[1]+" - Parchment":"Parchment";if(h.page_title)a.document.title=storyName;if(i)i=parchment.vms[i[1]];else for(;e<parchment.vms.length;e++)if(parchment.vms[e].match.test(j)){i=parchment.vms[e];break}if(!i)throw new FatalError("File type is not supported!");try{this.launch(i,f)}catch(k){throw new FatalError(k);}},launch:function(a,
c){var d=this,g=[b.ajax(c[0],{dataType:"binary",legacy:c[1]}).done(function(a,b,c){c.library=d}).fail(i)],e=[],l=0,o;if(!a.loaded){for(a.loaded=1;l<a.files.length;)o=parchment.options.lib_path+a.files[l++],k.test(o)?e.push(b.getScript(o)):this.ui.stylesheet_add(a.id,o);g[1]=b.when.apply(1,e)}b.when.apply(1,g).done(a.launcher)},stories:new l,savefiles:{}});parchment.lib.Library=l;parchment.vms=[]})(window,jQuery);
parchment.vms.quixe={id:"quixe",match:/(ulx|glb|(g|glulx.+)(blorb|blb))(.js)?$/i,files:["prototype.min.js","glkote.min.js","quixe.min.js","../src/quixe/media/i7-glkote.css","../src/quixe/media/dialog.css"],launcher:function(a){var b=a[2],a=b.library,b=new parchment.lib.Story(b.responseArray,storyName),c={inspacing:0,outspacing:0,vm:Quixe};a.ui.stylesheet_switch("quixe",1);jQuery("#parchment").html('<div id="gameport"><div id="windowport"></div><div id="errorpane" style="display:none;"><div id="errorcontent">...</div></div><div id="layouttestpane">This should not be visible<div id="layouttest_grid" class="WindowFrame GridWindow"><div id="layouttest_gridline" class="GridLine"><span id="layouttest_gridspan" class="Style_normal">12345678</span></div><div id="layouttest_gridline2" class="GridLine"><span class="Style_normal">12345678</span></div></div><div id="layouttest_buffer" class="WindowFrame BufferWindow"><div id="layouttest_bufferline" class="BufferLine"><span id="layouttest_bufferspan" class="Style_normal">12345678</span></div><div id="layouttest_bufferline2" class="BufferLine"><span class="Style_normal">12345678</span></div></div></div></div>');
jQuery(".load").length>0&&jQuery(".load").detach();Quixe.prepare(b.glulx,c);Glk.init(c)}};parchment.vms.push(parchment.vms.quixe);
parchment.vms.gnusto={id:"gnusto",match:/(z[1-8]|zlb|(z|zcode.+)(blorb|blb))(.js)?$/i,files:["gnusto.min.js","zmachine.min.js"],launcher:function(a){var b=window.console&&function(a){console.log(a)}||function(){},c=a[2],a=new GnustoEngine(b),d=new parchment.lib.ZUI(c.library,a,b),d=new EngineRunner(a,d,b),c=new parchment.lib.Story(c.responseArray,storyName),g=location.hash;b("Story type: "+c.filetype);c.load(a);g&&g!="#"&&(a.loadSavedGame(file.base64_decode(g.slice(1))),b("Loading savefile"));d.run()}};
parchment.vms.push(parchment.vms.gnusto);(function(a,b){var c=a.parchment;b(function(){var d=/options=([^;&]+)/.exec(location.search);a.parchment_options&&b.extend(c.options,parchment_options);!c.options.lock_options&&d&&b.extend(c.options,b.parseJSON(unescape(d[1])));d=new c.lib.Library;c.library=d;d.load();location.href.indexOf("iplayif.com")!=-1&&b.getScript("http://google-analytics.com/ga.js",function(){_gat._getTracker("UA-7949545-3")._trackPageview()})})})(this,jQuery);